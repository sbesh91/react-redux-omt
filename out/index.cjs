var e=require("@preact/signals-react");function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var a,r=/*#__PURE__*/t(require("use-deep-compare-effect")),n=new e.Signal(null),u=new Map;exports.createWorkerSelector=function(e,t){return{name:e,fn:t}},exports.dispatch=function(e){var t;null==(t=a)||t.postMessage({type:"dispatch",action:e})},exports.initializeWorkerStore=function(e,t){function a(a,r){var n,u=null==t||null==(n=t[a.selector])?void 0:n.fn,s=a.params;if(u){var i=u.apply(void 0,[e.getState()].concat(s));postMessage({uuid:r,value:i})}}addEventListener("message",function(t){var r=t.data;switch(r.type){case"dispatch":e.dispatch(r.action);break;case"subscribe":u.set(r.uuid,r.selector),a(r.selector,r.uuid);break;case"unsubscribe":u.delete(r.uuid)}}),e.subscribe(function(){u.forEach(a)})},exports.initializeWorkerStoreListener=function(e){a=e,e.addEventListener("message",function(e){n.value=e.data})},exports.useWorkerSelector=function(t,u){var s=null==u?void 0:u.defaultValue,i=u&&"params"in u?u.params:[],o=e.useSignal(""),c=e.useSignal(s);return e.useSignalEffect(function(){var e=n.value;e&&e.uuid===o.peek()&&(c.value=e.value)}),r.default(function(){var e,r=crypto.randomUUID();return o.value=r,null==(e=a)||e.postMessage({type:"subscribe",uuid:r,selector:{selector:t.name,params:i}}),function(){var e;null==(e=a)||e.postMessage({type:"unsubscribe",uuid:r})}},[t,i]),c};
//# sourceMappingURL=index.cjs.map
