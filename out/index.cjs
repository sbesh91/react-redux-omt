var e=require("@preact/signals-react");function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var a,r,n=/*#__PURE__*/t(require("use-deep-compare-effect")),u=new e.Signal(null),s=new Map;exports.createWorkerSelector=function(e,t){return{name:e,fn:t}},exports.dispatch=function(e){var t;null==(t=a)||t.postMessage({type:"dispatch",action:e})},exports.initializeWorkerStore=function(e,t){function a(t,a){var n,u,s,i=null==(n=r)||null==(u=n[t.selector])?void 0:u.fn,c=null!=(s=t.params)?s:[];if(i){var o=i.apply(void 0,[e.getState()].concat(c));postMessage({uuid:a,value:o})}}r=t,addEventListener("message",function(t){var r=t.data;switch(r.type){case"dispatch":e.dispatch(r.action);break;case"subscribe":s.set(r.uuid,r.selector),a(r.selector,r.uuid);break;case"unsubscribe":s.delete(r.uuid)}}),e.subscribe(function(){s.forEach(a)})},exports.initializeWorkerStoreListener=function(e){a=e,e.addEventListener("message",function(e){u.value=e.data})},exports.useWorkerSelector=function(t,r,s){var i=e.useSignal(""),c=e.useSignal(s);return e.useSignalEffect(function(){var e=u.value;e&&e.uuid===i.peek()&&(c.value=e.value)}),n.default(function(){var e,n=crypto.randomUUID();return i.value=n,null==(e=a)||e.postMessage({type:"subscribe",uuid:n,selector:{selector:t.name,params:r}}),function(){var e;null==(e=a)||e.postMessage({type:"unsubscribe",uuid:n})}},[t,r]),c};
//# sourceMappingURL=index.cjs.map
